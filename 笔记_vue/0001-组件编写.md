# Vue 2 组件编写

## 脚手架（`MyVuePlugin.js`）

### 最简（es/cmd）结构

```
export class MyVuePlugin {

    inistall( Vue, options ) {

        console.log( '注入 MyVuePlugin 组件成功' );

        // @TODO : coding
    }
}
```

### umd 结构【推荐】

```
( function( plugin ) {

    if ( typeof exports === 'object' ) {

        module.exports = plugin;

    } else if ( typeof define === 'function' && define.amd ) {

        define( [], function() { return plugin } );

    } else if ( typeof window === 'object' && window.Vue ) {

        window.MyVuePlugin = plugin;

        Vue.use( plugin );
    }

} )( function() {

    return {

        /**
         * Vue 插件必备方法（类似于入口函数）
         * 
         * @param {Object} Vue vue 的主题
         * @param {any} options 传到组件的参数，可选项，此数据由 Vue.use( MyVuePlugin, options ) 的 options 决定
         */
        install : function( Vue, options ) {

            console.log( '注入 MyVuePlugin 组件成功' );

            // @TODO : coding
        }
    };

}() );
```

## 准备环境【选读】

### 方式一：使用 `vue-cli` 构建项目

1. 全局安装 webpack 和 vue-cli ：`npm install -g webpack vue-cli`

1. 在你的项目文件夹父级运行 `vue init webpack-simple my-vue-plugin-demo`，过程中的参数可直接按 enter 不填写

1. 然后 `cd my-vue-plugin-demo && npm install`

1. 在 `package.json` 的 `scripts` 一栏中，添加 `"webpack": "webpack --watch"`

1. 修改 `src/main.js`

    ```
    import Vue from 'vue'
    import App from './App.vue'
    import MyVuePlugin from './MyVuePlugin'

    Vue.use( MyVuePlugin );

    new Vue( {
        el      : '#app',
        render  : h => h( App )
    } )
    ```

1. 执行 `npm run webpack` 和 `npm run dev` 即可看到 `Console` 信息中有打印 “注入 MyVuePlugin 组件成功”

### 方式二：使用 amd 组建项目

准备 `index.html`、`main.js` 以及引用 `https://cdn.bootcss.com/vue/2.3.3/vue.min.js`、`https://cdn.bootcss.com/require.js/2.3.3/require.min.js`，具体文件内容请自行百度。

### 方式三：传统/同步方式组建项目

准备 `index.html` 以及引用 `https://cdn.bootcss.com/vue/2.3.3/vue.min.js`，具体文件内容请自行 YY。

## `install` 函数使用

```
function ( Vue, options ) {

    // 1. 添加全局方法或属性
    Vue.myVuePluginMethod = function () {
        // @TODO : coding
    }
    Vue.myVuePluginProp = "I am MyVuePluginProp";

    // 2. 添加全局资源/自定义指令
    Vue.directive( 'my-vue-plugin', {

        bind( el, binding, vnode, oldVnode ) {
            // @TODO : coding
        }
        ...
    } )

    // 3. 注入组件
    Vue.mixin( {
        created: function () {
            // @TODO : coding
        }
        ...
    } )

    // 4. 添加实例方法
    Vue.prototype.$myVuePluginMethod = function ( options ) {
        // @TODO : coding
    }
}
```

### 添加全局方法或属性

```
Vue.myVuePluginMethod = function () {
    // @TODO : coding
}

Vue.myVuePluginProp = "I am MyVuePluginProp";
```

注意：

* 子组件拿取 `Vue` 对应的属性和调用内部事件，要 `import Vue from 'vue'` 才能正确执行，修改 `src/App.vue` 如下：
    ```
    <script>
    import Vue from 'vue';

    export default {
        name: 'app',
        data () {
            return {
            msg: 'Welcome to AB Vue.js App'
            }
        },
        created() {
            console.log( Vue.myVuePluginProp ); // 打印 “I am MyVuePluginProp” 字段
        }
    }
    </script>
    ```

* 建议以 `$` 开头，降低与 Vue 已定属性、函数冲突

### 添加全局资源/自定义指令

> 除了默认设置的核心指令( v-model 和 v-show ),Vue 也允许注册自定义指令。注意，在 Vue2.0 里面，代码复用的主要形式和抽象是组件——然而，有的情况下,你仍然需要对纯 DOM 元素进行底层操作,这时候就会用到自定义指令。【Vue 官方文档】
>

```
/**
 * 形式 1
 */
Vue.directive( 'my-vue-plugin', function ( el, binding ) {

    // bind 和 update 阶段会调用此函数

    el.style.backgroundColor = binding.value;
} );

/**
 * 形式 2
 */
Vue.directive( 'my-vue-plugin', {

    // 只调用一次，指令第一次绑定到元素时调用，用这个钩子
    // 函数可以定义一个在绑定时执行一次的初始化动作
    bind( el, binding, vnode, oldVnode ) {},

    // 被绑定元素插入父节点时调用（父节点存在即可调用，不
    // 必存在于 document 中）
    inserted( el, binding, vnode, oldVnode ) {},

    // 被绑定元素所在的模板更新时调用，而不论绑定值是否变
    // 化。通过比较更新前后的绑定值，可以忽略不必要的模板
    // 更新
    update( el, binding, vnode, oldVnode ) {},

    // 被绑定元素所在模板完成一次更新周期时调用
    componentUpdated( el, binding, vnode, oldVnode ) {},

    // 只调用一次， 指令与元素解绑时调用
    unbind( el, binding, vnode, oldVnode ) {},
} )
```

参数说明（来自官方文档）：

* `el`：指令所绑定的元素，可以用来直接操作 DOM
* `binding`：一个对象，包含以下属性：
    * `name`：指令名，不包括 v- 前缀
    * `rawName`：指令名，包括 v- 前缀
    * `value`：指令的绑定值，例如： `v-my-directive="1 + 1"`, value 的值是 `2`【不含等值时，即直接为 `v-my-vue-plugin`，此属性不存在】
    * `oldValue`：指令绑定的前一个值，仅在 `update` 和 `componentUpdated` 钩子中可用。无论值是否改变都可用【不含等值时，即直接为 `v-my-vue-plugin`，此属性不存在】
    * `expression`：绑定值的字符串形式。 例如 `v-my-directive="1 + 1"` ， expression 的值是 `"1 + 1"`
    * `arg`：传给指令的参数。例如 `v-my-directive:foo`， arg 的值是 `"foo"`
    * `modifiers`：一个包含修饰符的对象。 例如： `v-my-directive.foo.bar`, 修饰符对象 modifiers 的值是 `{ foo: true, bar: true }`
* `vnode`：Vue 编译生成的虚拟节点，查阅 [VNode API](https://cn.vuejs.org/v2/api/#ignoredElements) 了解更多详情
* `oldVnode`：上一个虚拟节点，仅在 `update` 和 `componentUpdated` 钩子中可用

参数注意：

* 不含等值时，即直接为 `v-my-vue-plugin`，`binding` 只存在 `name` 和 `rawName` 两个属性

### 注入组件

### 添加实例方法

## 参考资源

* [插件](https://cn.vuejs.org/v2/guide/plugins.html)
* [Vue插件开发入门](http://www.cnblogs.com/libin-1/p/6254390.html)
* [自定义指令](https://cn.vuejs.org/v2/guide/custom-directive.html)